<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Player.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ootp-ai</a> &gt; <a href="index.source.html" class="el_package">com.github.lstephen.ootp.ai.player</a> &gt; <span class="el_source">Player.java</span></div><h1>Player.java</h1><pre class="source lang-java linenums">package com.github.lstephen.ootp.ai.player;

import com.github.lstephen.ootp.ai.player.ratings.BattingRatings;
import com.github.lstephen.ootp.ai.player.ratings.DefensiveRatings;
import com.github.lstephen.ootp.ai.player.ratings.PitchingRatings;
import com.github.lstephen.ootp.ai.player.ratings.PlayerRatings;
import com.github.lstephen.ootp.ai.player.ratings.Position;
import com.github.lstephen.ootp.ai.player.ratings.RatingsDefinition;
import com.github.lstephen.ootp.ai.player.ratings.StarRating;
import com.github.lstephen.ootp.ai.splits.Splits;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonProperty;

import com.google.common.base.Function;
import com.google.common.base.Joiner;
import com.google.common.base.Optional;
import com.google.common.base.Preconditions;
import com.google.common.collect.ImmutableList;
import com.google.common.collect.Ordering;

import java.util.Arrays;
import java.util.List;

import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.builder.ToStringBuilder;

/**
 *
 * @author lstephen
 */
public final class Player {

<span class="fc" id="L35">    private static final Integer MAX_SURNAME_LENGTH = 12;</span>

    private final PlayerId id;

    private final String name;

    private int age;

    private String team;

    private String salary;

    private final PlayerRatings ratings;

    private BattingHand battingHand;

<span class="fc" id="L51">    @JsonIgnore</span>
<span class="fc" id="L52">    private Optional&lt;String&gt; listedPosition = Optional.absent();</span>

<span class="fc" id="L54">    @JsonIgnore</span>
<span class="fc" id="L55">    private RosterStatus rosterStatus = RosterStatus.create();</span>

    @JsonIgnore
    private ImmutableList&lt;Slot&gt; slots;

<span class="fc" id="L60">    @JsonIgnore</span>
<span class="fc" id="L61">    private Optional&lt;StarRating&gt; stars = Optional.absent();</span>

<span class="fc" id="L63">    @JsonIgnore</span>
<span class="fc" id="L64">    private Optional&lt;Clutch&gt; clutch = Optional.absent();</span>

<span class="fc" id="L66">    @JsonIgnore</span>
<span class="fc" id="L67">    private Optional&lt;Consistency&gt; consistency = Optional.absent();</span>

<span class="fc" id="L69">    private Player(PlayerId id, String name, PlayerRatings ratings) {</span>
<span class="fc" id="L70">        this.id = id;</span>
<span class="fc" id="L71">        this.name = name;</span>
<span class="fc" id="L72">        this.ratings = ratings;</span>
<span class="fc" id="L73">    }</span>

<span class="nc" id="L75">    public PlayerId getId() { return id; }</span>

    public boolean hasId(PlayerId id) {
<span class="nc" id="L78">        return this.id.equals(id);</span>
    }

    public void setRatingsDefinition(RatingsDefinition definition) {
<span class="nc" id="L82">        ratings.setDefinition(definition);</span>
<span class="nc" id="L83">    }</span>

<span class="fc" id="L85">    public String getName() { return name; }</span>

    public String getShortName() {
<span class="nc" id="L88">        List&lt;String&gt; names = Arrays.asList(StringUtils.split(name));</span>

<span class="nc" id="L90">        String surnames =</span>
<span class="nc" id="L91">            StringUtils.abbreviate(</span>
                Joiner
<span class="nc" id="L93">                    .on(' ')</span>
<span class="nc" id="L94">                    .join(names.subList(1, names.size())), MAX_SURNAME_LENGTH);</span>

<span class="nc" id="L96">        Character initial = names.get(0).charAt(0);</span>

<span class="nc" id="L98">        return String.format(&quot;%s, %s&quot;, surnames, initial);</span>
    }

    public String getFirstName() {
<span class="nc" id="L102">        return Arrays.asList(StringUtils.split(name)).get(0);</span>
    }

<span class="fc" id="L105">    public int getAge() { return age; }</span>
<span class="fc" id="L106">    public void setAge(int age) { this.age = age; }</span>

<span class="nc" id="L108">    public String getTeam() { return team; }</span>
<span class="fc" id="L109">    public void setTeam(String team) { this.team = team; }</span>

<span class="nc" id="L111">    public String getSalary() { return salary; }</span>
<span class="fc" id="L112">    public void setSalary(String salary) { this.salary = salary; }</span>

<span class="nc" id="L114">    public BattingHand getBattingHand() { return battingHand; }</span>
    public void setBattingHand(BattingHand battingHand) {
<span class="fc" id="L116">        this.battingHand = battingHand;</span>
<span class="fc" id="L117">    }</span>

    public Optional&lt;StarRating&gt; getStars() {
<span class="nc" id="L120">        return stars;</span>
    }

    public void setStars(StarRating stars) {
<span class="fc" id="L124">        this.stars = Optional.of(stars);</span>
<span class="fc" id="L125">    }</span>

    public Optional&lt;Clutch&gt; getClutch() {
<span class="nc" id="L128">      return clutch;</span>
    }

    public void setClutch(Clutch clutch) {
<span class="fc" id="L132">      this.clutch = Optional.of(clutch);</span>
<span class="fc" id="L133">    }</span>

    public Optional&lt;Consistency&gt; getConsistency() {
<span class="nc" id="L136">      return consistency;</span>
    }

    public void setConsistency(Consistency consistency) {
<span class="fc" id="L140">      this.consistency = Optional.of(consistency);</span>
<span class="fc" id="L141">    }</span>

    public String getIntangibles() {
<span class="nc" id="L144">      String clutch = &quot; &quot;;</span>

<span class="nc bnc" id="L146" title="All 2 branches missed.">      if (getClutch().isPresent()) {</span>
<span class="nc bnc" id="L147" title="All 3 branches missed.">        switch (getClutch().get()) {</span>
<span class="nc" id="L148">          case GREAT: clutch = &quot;+&quot;; break;</span>
<span class="nc" id="L149">          case SUFFERS: clutch = &quot;-&quot;; break;</span>
          default: // nothing
        }
      }

<span class="nc" id="L154">      String consistency = &quot; &quot;;</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">      if (getConsistency().isPresent()) {</span>
<span class="nc bnc" id="L156" title="All 3 branches missed.">        switch (getConsistency().get()) {</span>
<span class="nc" id="L157">          case GOOD: consistency = &quot;+&quot;; break;</span>
<span class="nc" id="L158">          case VERY_INCONSISTENT: consistency = &quot;-&quot;; break;</span>
          default: // nothing
        }
      }

<span class="nc" id="L163">      return clutch + consistency;</span>
    }

    public Optional&lt;Boolean&gt; getOn40Man() {
<span class="nc" id="L167">        return rosterStatus.getOn40Man();</span>
    }


    public void setOn40Man(Boolean on40Man) {
<span class="nc" id="L172">        rosterStatus.setOn40Man(on40Man);</span>
<span class="nc" id="L173">    }</span>

    public Optional&lt;Boolean&gt; getRuleFiveEligible() {
<span class="nc" id="L176">        return rosterStatus.getRuleFiveEligible();</span>
    }

    public void setRuleFiveEligible(Boolean ruleFiveEligible) {
<span class="nc" id="L180">        rosterStatus.setRuleFiveEligible(ruleFiveEligible);</span>
<span class="nc" id="L181">    }</span>

    public Optional&lt;Boolean&gt; getOutOfOptions() {
<span class="nc" id="L184">        return rosterStatus.getOutOfOptions();</span>
    }

    public void setOutOfOptions(Boolean outOfOptions) {
<span class="nc" id="L188">        rosterStatus.setOutOfOptions(outOfOptions);</span>
<span class="nc" id="L189">    }</span>

    public Optional&lt;Boolean&gt; getClearedWaivers() {
<span class="nc" id="L192">        return rosterStatus.getClearedWaivers();</span>
    }

    public void setClearedWaivers(Boolean clearedWaivers) {
<span class="nc" id="L196">        rosterStatus.setClearedWaivers(clearedWaivers);</span>
<span class="nc" id="L197">    }</span>

    public Optional&lt;Integer&gt; getYearsOfProService() {
<span class="nc" id="L200">        return rosterStatus.getYearsOfProService();</span>
    }

    public void setYearsOfProService(Integer years) {
<span class="nc" id="L204">        rosterStatus.setYearsOfProService(years);</span>
<span class="nc" id="L205">    }</span>

    public Optional&lt;Integer&gt; getTeamTopProspectPosition() {
<span class="nc" id="L208">        return rosterStatus.getTeamTopProspectPosition();</span>
    }

    public void setTeamTopProspectPosition(Integer position) {
<span class="nc" id="L212">        rosterStatus.setTeamTopProspectPosition(position);</span>
<span class="nc" id="L213">    }</span>

    public Boolean isInjured() {
<span class="nc" id="L216">        return rosterStatus.isInjured();</span>
    }

    public void setInjured(Boolean injured) {
<span class="fc" id="L220">        rosterStatus.setInjured(injured);</span>
<span class="fc" id="L221">    }</span>

    public Boolean isUpcomingFreeAgent() {
<span class="nc" id="L224">        return rosterStatus.isUpcomingFreeAgent();</span>
    }

    public void setUpcomingFreeAgent(Boolean ufa) {
<span class="fc" id="L228">        rosterStatus.setUpcomingFreeAgent(ufa);</span>
<span class="fc" id="L229">    }</span>

    public ImmutableList&lt;Slot&gt; getSlots() {
<span class="nc bnc" id="L232" title="All 2 branches missed.">        if (slots == null) {</span>
<span class="nc" id="L233">            slots = Slot.getPlayerSlots(this);</span>
        }
<span class="nc" id="L235">        return slots;</span>
    }

    public String getRosterStatus() {
<span class="nc" id="L239">        StringBuilder str = new StringBuilder();</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">        str.append(isInjured() ? &quot;I&quot; : &quot; &quot;);</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">        str.append(isUpcomingFreeAgent() ? &quot;F&quot; : &quot; &quot;);</span>

<span class="nc" id="L244">        Optional&lt;Integer&gt; pos = getTeamTopProspectPosition();</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (pos.isPresent()) {</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">            if (pos.get() &gt; 10) {</span>
<span class="nc" id="L247">                str.append(&quot;&gt;&quot;);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">            } else if (pos.get() == 10) {</span>
<span class="nc" id="L249">                str.append(&quot;T&quot;);</span>
            } else {
<span class="nc" id="L251">                str.append(pos.get());</span>
            }
        } else {
<span class="nc" id="L254">            str.append(&quot; &quot;);</span>
        }

<span class="nc bnc" id="L257" title="All 2 branches missed.">        if (getOn40Man().isPresent()) {</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">            str.append(getOn40Man().get() ? &quot;*&quot; : &quot; &quot;);</span>
        }

<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (getOutOfOptions().isPresent()) {</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">            str.append(getOutOfOptions().get() ? &quot;+&quot; : &quot; &quot;);</span>
        }

<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (getRuleFiveEligible().isPresent()) {</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">            str.append(getRuleFiveEligible().get() ? &quot;#&quot; : &quot; &quot;);</span>
        }

<span class="nc bnc" id="L269" title="All 2 branches missed.">        if (getClearedWaivers().isPresent()) {</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">            str.append(getClearedWaivers().get() ? &quot;~&quot; : &quot; &quot;);</span>
        }

<span class="nc" id="L273">        return str.toString();</span>
    }

    public String getPosition() {
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (hasPitchingRatings()) {</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">            return getPitchingRatings().getVsRight().getEndurance() &gt; 5</span>
                ? &quot;SP&quot;
                : &quot;MR&quot;;
        } else {
<span class="nc" id="L282">            return getDefensiveRatings().getPrimaryPosition();</span>
        }
    }

    public Optional&lt;String&gt; getListedPosition() {
<span class="nc" id="L287">        return listedPosition;</span>
    }

    public void setListedPosition(String listedPosition) {
<span class="fc" id="L291">        this.listedPosition = Optional.of(listedPosition);</span>
<span class="fc" id="L292">    }</span>

    @JsonIgnore
    public boolean isHitter() {
<span class="nc bnc" id="L296" title="All 4 branches missed.">        return getBattingRatings() != null &amp;&amp; !isPitcher();</span>
    }

    @JsonIgnore
    public boolean isPitcher() {
<span class="nc" id="L301">        return hasPitchingRatings();</span>
    }

    public Boolean canPlay(Position pos) {
<span class="nc bnc" id="L305" title="All 4 branches missed.">        return pos == Position.DESIGNATED_HITTER</span>
            || pos == Position.FIRST_BASE
<span class="nc bnc" id="L307" title="All 2 branches missed.">            || getDefensiveRatings().getPositionScore(pos) &gt; 1.0e-6;</span>
    }

    public DefensiveRatings getDefensiveRatings() {
<span class="fc" id="L311">        return ratings.getDefensive();</span>
    }

    public Splits&lt;BattingRatings&lt;?&gt;&gt; getBattingRatings() {
<span class="fc" id="L315">        return ratings.getBatting();</span>
    }

    public Splits&lt;BattingRatings&lt;Integer&gt;&gt; getBattingPotentialRatings() {
<span class="nc" id="L319">        return ratings.getBattingPotential(age);</span>
    }

    public boolean hasPitchingRatings() {
<span class="nc" id="L323">        return ratings.hasPitching();</span>
    }

    public Splits&lt;PitchingRatings&lt;?&gt;&gt; getPitchingRatings() {
<span class="fc" id="L327">        return ratings.getPitching();</span>
    }

    public Splits&lt;PitchingRatings&lt;Integer&gt;&gt; getPitchingPotentialRatings() {
<span class="nc" id="L331">        return ratings.getPitchingPotential(age);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="nc bnc" id="L336" title="All 2 branches missed.">        if (obj == null) { return false; }</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">        if (obj == this) { return true; }</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">        if (!obj.getClass().equals(getClass())) { return false; }</span>

<span class="nc" id="L340">        return Player.class.cast(obj).id.equals(id);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L345">        return id.hashCode();</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L350">        return ToStringBuilder.reflectionToString(this);</span>
    }

    @JsonCreator
    public static Player create(
        @JsonProperty(&quot;id&quot;) PlayerId id,
        @JsonProperty(&quot;name&quot;) String name,
        @JsonProperty(&quot;ratings&quot;) PlayerRatings ratings) {

<span class="fc" id="L359">        return new Player(id, name, ratings);</span>
    }

    /**
     * An ordering designed to produce consistent results when players are
     * otherwise valued equally.
     */
    public static Ordering&lt;Player&gt; byTieBreak() {
<span class="nc" id="L367">        return Player.byAge().compound(Player.byShortName());</span>
    }

    public static Ordering&lt;Player&gt; byAge() {
        return Ordering
<span class="nc" id="L372">            .natural()</span>
<span class="nc" id="L373">            .onResultOf(Player::getAge);</span>
    }

    public static Ordering&lt;Player&gt; byShortName() {
        return Ordering
<span class="nc" id="L378">            .natural()</span>
<span class="nc" id="L379">            .onResultOf(Player::getShortName);</span>
    }

    public static Ordering&lt;Player&gt; byWeightedBattingRating() {
        return Ordering
<span class="nc" id="L384">            .natural()</span>
<span class="nc" id="L385">            .reverse()</span>
<span class="nc" id="L386">            .onResultOf(new Function&lt;Player, Double&gt;() {</span>
                @Override
                public Double apply(Player p) {
<span class="nc" id="L389">                    Preconditions.checkNotNull(p);</span>

<span class="nc" id="L391">                    BattingRatings ratings =</span>
<span class="nc" id="L392">                        PlayerRatings.getOverallBatting(p.getBattingRatings());</span>

                    // We don't use calculated WOBA constants, as we want to be
                    // able to use this when we have no stats/regression available
<span class="nc" id="L396">                    return 0.7 * ratings.getEye()</span>
<span class="nc" id="L397">                        + 0.9 * ratings.getContact()</span>
<span class="nc" id="L398">                        + 1.3 * ratings.getGap()</span>
<span class="nc" id="L399">                        + 2.0 * ratings.getPower();</span>
                }
            });
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>